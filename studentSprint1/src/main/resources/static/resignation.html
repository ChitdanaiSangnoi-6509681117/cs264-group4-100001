<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8" style="font-family: 'Noto Sans Thai', sans-serif;">
    <!--Latest compiled and minified CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

    <!--Latest compiled JavaScript-->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!--add CSS file-->
    <link href="Style/style_regisnation.css" rel="stylesheet"/>

    <!--font thai-->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Prompt&family=Roboto&display=swap" rel="stylesheet">

    <title>สำนักทะเบียน</title>
</head>
<body>
<!--Head of web page-->
<nav id="topSidebar" class="w-100 p-1">
    <img src="Emblem_of_Thammasat_University.png" width="50" height="50" />
    <label>THAMMASAT UNIVERSITY</label>
</nav>
<!--left sidebar-->
<nav id="leftSidebar" class="h-100 d-inline-block">
    <button class=" button_leftside" id="student_personal_information" type="button" onclick="window.location.href='Personal_information.html'">ประวัตินักศึกษา</button><br>
    <button class=" button_leftside" id="student_notifications" type="button">การแจ้งเตือน</button><br>
    <button class=" button_leftside" id="track_request_status" type="button">ติดตามสถานะคำร้อง</button><br>
    <button class=" button_leftside" id="submit_a_complaint" type="button" type="button"onclick="window.location.href='Main_request.html'">ยื่นคำร้อง</button><br>
    <button class=" button_leftside" id="appointment_of_advisor" type="button">การนัดหมายอาจารย์ที่ปรึกษา</button><br>
    <button class=" button_leftside" id="pay_a_fine" type="button">ชำระค่าปรับ</button><br>
</nav>
<!--Body of web page-->
<nav class="body">
    <div class="container-fluid bg-white">
        <label id="headBody">คำร้องขอลาออก</label>
        <form onsubmit="this.reset(); return false">
            <div class="row">
                <div class="col-2">
                    <br>
                    <label for="term">ภาคเรียนที่</label>
                    <select id="term" name="term" class="form-control mb-2" style="background-color:#D9D9D9;" required>
                        <option value=" "> </option>
                        <option value="1">1</option>
                        <option value="2">2</option>
                        <option value="Summer">Summer</option>
                    </select>
                    <div id="termError" style="color: red;"></div>
                </div>
                <div class="col-2">
                    <br>
                    <label for="year">ปีการศึกษา</label>
                    <select id="year" name="year" class="form-control mb-2" style="background-color:#D9D9D9;" required>
                        <option value="2566">2566</option>
                    </select>
                </div>
            </div>
            <br>
            <label id="headBody" for="reason" style="margin-bottom: 15px;">เหตุผลที่ขอลาออก</label>
            <div class="form-outline w-50 mb-4">

                <textarea id="reason" name="reason" rows="5" cols="100" class="form-control" style="resize:none; border-radius:20px; background-color:#D9D9D9;" required></textarea>
                <br><div id="reasonError" style="color: red;"></div>
            </div>
            <br>
            <label id="headBody"style="margin-bottom: 15px;">หนี้ค้างชำระ</label>
            <div class="row">
                <div class="col-2">
                    <input class="form-check-input" type="radio" name="debtOption" id="noDebt">
                    <label class="form-check-label" for="noDebt">ไม่มีหนี้ค้างชำระ</label>
                </div>
                <div class="col-2">
                    <input class="form-check-input" type="radio" name="debtOption" id="yesDebt">
                    <label class="form-check-label" for="yesDebt">มีหนี้ค้างชำระกับ</label>
                </div>
                <div class="col-2">
                    <input type="text" id="dept" name="dept" class="form-control mb-2" style="background-color:#D9D9D9;" required>
                </div>
                <div class="col-1"><p>จำนวน</p></div>
                <div class="col-2">
                    <input type="text" id="amount" name="amount" class="form-control mb-2" style="background-color:#D9D9D9;" required>
                </div>
                <div class="col"><p>บาท</p></div>
                <br><div id="deptError" style="color: red;"></div>
            </div>
            <div class="row">
                <div class="col-2">
                    <input class="form-check-input" type="radio" name="gradeOption" id="wantGrade">
                    <label class="form-check-label" for="wantGrade">ต้องการใบเกรด</label>
                </div>
                <div class="col-2">
                    <input class="form-check-input" type="radio" name="gradeOption" id="noWantGrade">
                    <label class="form-check-label" for="noWantGrade">ไม่ต้องการใบเกรด</label><br>
                </div>
                <br><div id="gradeOptionError" style="color: red;"></div>
            </div>
            <br>
            <div class="row">
                <div class="col">
                    <button type="button" class="button_down" onclick="window.location.href='fileAttachment.html'">แนบไฟล์เพิ่มเติม</button>
                </div>
                <div class="col d-flex justify-content-end">
                    <div class="d-grid gap-2 d-md-block">
                        <button class=" button_down" type="button" onclick="goToHomePage()">กลับสู่หน้าแรก</button></button>
                        <button  class="button_down" type="button" onclick="submitForm()">ยืนยันการส่งคำร้อง</button>
                    </div>
                </div>
            </div>
        </form>
    </div>
</nav>
</body>
</html>
<script>

    function goToHomePage() {
       var isConfirmed = confirm("คุณแน่ใจหรือว่าต้องการกลับสู่หน้าแรก? การกรอกข้อมูลในแบบฟอร์มนี้จะถูกลบทิ้ง");
       if (isConfirmed) {
           window.location.href = 'student_welcome.html';
       }
   }

   var jsonData = JSON.parse(localStorage.getItem('jsonData'));

    function submitForm() {

    var term = document.getElementById("term").value;
    var reason = document.getElementById("reason").value;
    var noDebtRadio = document.getElementById("noDebt");
    var yesDebtRadio = document.getElementById("yesDebt");
    var wantGrade = document.getElementById("wantGrade");
    var noWantGrade= document.getElementById("noWantGrade");
    var dept = document.getElementById("dept").value;
    var amount = document.getElementById("amount").value;
    var year = document.getElementById("year").value;

    if (noDebtRadio.checked) {
    var debtOption = "ไม่มีหนี้ค้างชำระ";
    dept = "none";
    amount = "0";
    document.getElementById("deptError").innerText = "";
    } else if (yesDebtRadio.checked) {
    var debtOption = "มีหนี้ค้างชำระ";
    document.getElementById("deptError").innerText = "";

    } else {
        var debtOption = "";
        document.getElementById("deptError").innerText = "กรุณาเลือกตัวเลือกหนี้";
}

if (wantGrade.checked) {
    var gradeOption = "ต้องการใบเกรด";
    document.getElementById("gradeOptionError").innerText = "";
    } else if (noWantGrade.checked) {
    var gradeOption = "ไม่ต้องการใบเกรด";
    document.getElementById("gradeOptionError").innerText = "";
    } else {
        var gradeOption = "";
        document.getElementById("gradeOptionError").innerText = "กรุณาเลือกตัวเลือกใบเกรด";
}
    if (term === " ") {
        document.getElementById("termError").innerText = "กรุณาเลือกภาคเรียน";
    } else {
        document.getElementById("termError").innerText = " ";
    }

    if (reason===""){
        document.getElementById("reasonError").innerText = "กรุณาระบุเหตุผล";
    }
    else{
        document.getElementById("reasonError").innerText = "";
    }

    if (term === " " || debtOption === ""|| gradeOption === "" || reason==="") {
        return;
    }

    var data = { ...jsonData, term, year, reason, debtOption, dept, amount, gradeOption };
    mergedData = JSON.stringify(data);

    const xhr = new XMLHttpRequest();
    xhr.open("POST", "/api/requestForm", true);
    xhr.setRequestHeader("Content-Type", "application/json;charset=utf-8");
    xhr.onreadystatechange = function () {
        if (xhr.readyState === 4 && (xhr.status === 200 || xhr.status === 201)) {
            console.log("Data sent successfully");
            window.location.href='request_submission.html';
        } else if (xhr.readyState === 4 && (xhr.status !== 200 && xhr.status !== 201)) {
            console.error("An error occurred sending data.");
        }
    }//function xhr
    xhr.send(mergedData);
}
</script>