<!DOCTYPE html>
<html>
<head>
    <title>แนบเอกสาร</title>

</head>
<body>

<h1>แนบเอกสาร</h1>
<p>กรุณารวมไฟล์เอกสารที่จำเป็น เป็นไฟล์ pdf ไฟล์ที่มีขนาดไม่เกิน 10 MB (สามารถเลือกได้หลายไฟล์)</p>

<label for="userFiles">เลือกไฟล์ (ไม่เกิน 10 MB ต่อไฟล์): </label>
<input type="file" id="userFiles" name="userFiles" multiple><br>
<label id="errorFiles" style="color: red"></label>

<div class="col d-flex justify-content-end">
    <div class="d-grid gap-2 d-md-block">
        <button class="button_down" class="btn btn-primary" type="button" onclick="goToHomePage()">กลับสู่หน้าแรก</button></button>
        <button class="button_down" class="btn btn-primary" type="button" onclick="goBack()">ย้อนกลับ</button>
    </div>
    <button id="submitButton">ยืนยันการแนบไฟล์</button>
</div>

</body>
</html>

<script>
    var inputFile = document.getElementById("userFiles");
 var submitButton = document.getElementById("submitButton");
 var fileData = [];

 function goToHomePage() {
     var isConfirmed = confirm("คุณแน่ใจหรือว่าต้องการกลับสู่หน้าแรก? การกรอกข้อมูลในแบบฟอร์มนี้จะถูกลบทิ้ง");
     if (isConfirmed) {
         window.location.href = 'index.html';
     }
 }

 function goBack() {
     window.history.back();
 }

 submitButton.addEventListener('click', function () {
     var limitSize = 10;
     var files = inputFile.files;
     var errorMessages = [];

     if (files.length === 0) {
         alert("กรุณาเลือกไฟล์ก่อนยืนยันการแนบไฟล์");
         return;
     }

     for (var i = 0; i < files.length; i++) {
         var fileSize = files[i].size;
         var fileSizeInMB = fileSize / (1024 * 1024);

         if (fileSizeInMB > limitSize) {
             console.log("ERROR: user file " + (i + 1) + " is too big");
             errorMessages.push("ไฟล์ที่ " + (i + 1) + " ของคุณมีขนาดเกินกว่า 10 MB!!");
         } else {
             var fileObject = {
                 name: files[i].name,
                 size: fileSizeInMB + ' MB'
             };


             fileData.push(fileObject);
         }
     }

     if (errorMessages.length > 0) {
         document.getElementById("errorFiles").innerHTML = errorMessages.join("<br>");
     } else {
         document.getElementById("errorFiles").innerHTML = "";

         var jsonData = {
             file: fileData
         };

         localStorage.setItem('jsonData', JSON.stringify(jsonData));

         alert("การแนบไฟล์เสร็จสิ้น");
         window.history.back();
     }
 });

</script>
</html>
